{% if type == "file" %}
  {% set files = "[]" %}
  {% set columnInfo = helper("models").get(display.model).columnInfo(field) %}
  {% set records = [] %}
  {% if value is not empty %}
    {% if value is not iterable %}
      {% set value = value|preg_replace('/[,\\s]+/', ",")|split(",") %}
    {% endif %}
    {% set records = helper("db").query("files").condition("id", value).sort("FIELD(id, '" ~ (value|join("','") ~ "')")).all() %}
    {% set files = [] %}
    {% for record in records %}
      {% set record = record|merge({
        "url": helper("filesystems").getFilesystem(record.location).getUrl(record.id ~ "_" ~ record.filename)
      }) %}
      {% if record.mime_type|split("/")|first == "image" %}
        {% set record = record|merge({
          "thumbnail": helper("images").thumb(record.location ~ "://" ~ record.id ~ "_" ~ record.filename, {"w": 168, "h": 168, "a": 1}),
        }) %}
      {% endif %}
      {% set files = files|merge([record]) %}
    {% endfor %}
    {% if files is not empty %}
      {% set files = files|json_encode|replace({'"': "'"}) %}
    {% endif %}
  {% endif %}
  {% set attrs = 'data-dojo-type="starbug/form/FileSelect" data-dojo-props="input_name:\'' ~ attributes.name ~ '\', files:' ~ files %}
  {% if attributes.size is defined %}
    {% set attrs = attrs ~ ', size:' ~ attributes.size %}
  {% endif %}
  {% if attributes.browseEnabled is defined %}
    {% set attrs = attrs ~ ', browseEnabled:' ~ attributes.browseEnabled %}
  {% endif %}
  {% if attributes.location is defined %}
    {% set attrs = attrs ~ ', location:' ~ "'" ~ attributes.location ~ "'" %}
  {% endif %}
  {% set attrs = attrs ~ '"' %}
  <div {{ attrs }}></div>
{% else %}
  {% if type == "checkbox" %}
    <input {{ helper("filter").attributes({"type": "hidden", "id": attributes.id ~ "-hidden", "value": unchecked, "name": attributes.name})|raw }}/>
    {% set attributes = attributes|merge({"class": attributes.class ~ " checkbox"}) %}
  {% endif %}
  <input {{ helper("filter").attributes(attributes)|raw }}/>
{% endif %}
